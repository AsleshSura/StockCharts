<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Stock Chart Viewer</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.30.0/index.min.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Stock Chart Visualizer</h1>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <span class="theme-icon">ðŸŒ™</span>
                </button>
            </div>

            <div class="info-section">
                <h3>Stock Chart Visualizer</h3>
                <p>Get stock data and interactive charts for any publicly traded company.</p>
                <p><small><em>Note: Enter your API key below for real-time data, or leave empty to use demo data. Get a free API key from <a href="https://www.alphavantage.co/support/#api-key" target="_blank">Alpha Vantage</a>.</em></small></p>
            </div>

            <!-- Market Indices Section -->
            <div class="market-indices-section">
                <div class="indices-header">
                    <h3>Market Indices</h3>
                    <div class="market-status">
                        <span class="status-indicator" id="marketStatus">Market Status</span>
                    </div>
                </div>
                <div class="indices-container">
                    <div class="index-card" data-index="SPY" onclick="loadIndexChart('SPY', 'S&P 500')">
                        <div class="index-header">
                            <h4>S&P 500</h4>
                            <span class="index-symbol">SPY</span>
                        </div>
                        <div class="index-value">
                            <span class="index-price" id="spyPrice">Loading...</span>
                            <span class="index-change" id="spyChange">-</span>
                        </div>
                        <button class="index-chart-btn" onclick="event.stopPropagation(); loadIndexChart('SPY', 'S&P 500')">View Chart</button>
                    </div>
                    
                    <div class="index-card" data-index="QQQ" onclick="loadIndexChart('QQQ', 'NASDAQ')">
                        <div class="index-header">
                            <h4>NASDAQ</h4>
                            <span class="index-symbol">QQQ</span>
                        </div>
                        <div class="index-value">
                            <span class="index-price" id="qqqPrice">Loading...</span>
                            <span class="index-change" id="qqqChange">-</span>
                        </div>
                        <button class="index-chart-btn" onclick="event.stopPropagation(); loadIndexChart('QQQ', 'NASDAQ')">View Chart</button>
                    </div>
                    
                    <div class="index-card" data-index="DIA" onclick="loadIndexChart('DIA', 'Dow Jones')">
                        <div class="index-header">
                            <h4>Dow Jones</h4>
                            <span class="index-symbol">DIA</span>
                        </div>
                        <div class="index-value">
                            <span class="index-price" id="diaPrice">Loading...</span>
                            <span class="index-change" id="diaChange">-</span>
                        </div>
                        <button class="index-chart-btn" onclick="event.stopPropagation(); loadIndexChart('DIA', 'Dow Jones')">View Chart</button>
                    </div>
                </div>
                <div class="indices-refresh">
                    <button id="refreshIndices" onclick="refreshMarketIndices()">
                        <span class="refresh-icon">â†»</span>
                        Refresh Indices
                    </button>
                    <span class="last-updated">Last updated: <span id="lastUpdated">-</span></span>
                </div>
            </div>

            <div class="api-section">
                <div class="form-group">
                    <label for="apiKey">Alpha Vantage API Key (Optional):</label>
                    <input type="text" id="apiKey" placeholder="Enter your API key or leave empty for demo data" maxlength="50">
                    <small class="help-text">Leave empty to use demo data with limited functionality</small>
                </div>
            </div>

            <div class="mode-section">
                <div class="mode-toggle">
                    <span class="mode-option" id="singleLabel">Single</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="comparisonMode">
                        <span class="slider"></span>
                    </label>
                    <span class="mode-option" id="compareLabel">Compare</span>
                </div>
                <div class="mode-description">
                    <span id="modeDescription">View individual stock charts</span>
                </div>
            </div>

            <div class="search-section">
                <!-- Single Chart Mode -->
                <div id="singleMode" class="mode-container">
                    <div class="input-group">
                        <div class="form-group">
                            <label for="companySymbol">Stock Symbol:</label>
                            <input type="text" id="companySymbol" placeholder="TSLA" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label for="timeRange">Time Range:</label>
                            <select id="timeRange">
                                <option value="7" selected>Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="365">Last year</option>
                            </select>
                        </div>
                        <button id="searchButton" onclick="searchStock()">Set Chart</button>
                    </div>
                </div>

                <!-- Comparison Mode -->
                <div id="comparisonModeContainer" class="mode-container comparison-mode" style="display: none;">
                    <div class="comparison-inputs">
                        <div class="stock-input-group">
                            <h4>Stock A</h4>
                            <div class="input-group">
                                <div class="form-group">
                                    <label for="symbolA">Symbol:</label>
                                    <input type="text" id="symbolA" placeholder="AAPL" maxlength="10">
                                </div>
                            </div>
                        </div>
                        <div class="vs-divider">VS</div>
                        <div class="stock-input-group">
                            <h4>Stock B</h4>
                            <div class="input-group">
                                <div class="form-group">
                                    <label for="symbolB">Symbol:</label>
                                    <input type="text" id="symbolB" placeholder="GOOGL" maxlength="10">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-controls">
                        <div class="form-group">
                            <label for="comparisonTimeRange">Time Range:</label>
                            <select id="comparisonTimeRange">
                                <option value="7" selected>Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="365">Last year</option>
                            </select>
                        </div>
                        <button id="compareButton" onclick="compareStocks()">Compare Stocks</button>
                    </div>
                </div>
            </div>

            <div id="error" class="error"></div>

            <div class="chart-section">
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Loading stock data...</p>
                </div>

                <!-- Single Chart Mode -->
                <div id="singleChartContainer" class="single-chart-container">
                    <div id="stockInfo" class="stock-info">
                        <div class="info-card">
                            <div class="info-label">Company</div>
                            <div id="companyName" class="info-value">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Current Price</div>
                            <div id="currentPrice" class="info-value">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Change</div>
                            <div id="priceChange" class="info-value price-change">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">High</div>
                            <div id="dayHigh" class="info-value">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Low</div>
                            <div id="dayLow" class="info-value">-</div>
                        </div>
                    </div>

                    <!-- Export Controls -->
                    <div id="exportControls" class="export-controls" style="display: none;">
                        <h4>Export Options</h4>
                        <div class="export-buttons">
                            <button id="exportChartBtn" onclick="exportChartAsImage()">
                                <span>ðŸ“Š</span> Export Chart as PNG
                            </button>
                            <button id="exportDataBtn" onclick="exportDataAsCSV()">
                                <span>ðŸ“„</span> Export Data as CSV
                            </button>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="stockChart"></canvas>
                    </div>
                </div>

                <!-- Comparison Mode -->
                <div id="comparisonChartContainer" class="comparison-chart-container" style="display: none;">
                    <div class="comparison-info">
                        <div class="stock-info-side">
                            <h4 id="stockATitle">Stock A</h4>
                            <div id="stockInfoA" class="stock-info">
                                <div class="info-card">
                                    <div class="info-label">Company</div>
                                    <div id="companyNameA" class="info-value">-</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Current Price</div>
                                    <div id="currentPriceA" class="info-value">-</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Change</div>
                                    <div id="priceChangeA" class="info-value price-change">-</div>
                                </div>
                            </div>
                        </div>
                        <div class="stock-info-side">
                            <h4 id="stockBTitle">Stock B</h4>
                            <div id="stockInfoB" class="stock-info">
                                <div class="info-card">
                                    <div class="info-label">Company</div>
                                    <div id="companyNameB" class="info-value">-</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Current Price</div>
                                    <div id="currentPriceB" class="info-value">-</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Change</div>
                                    <div id="priceChangeB" class="info-value price-change">-</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Controls for Comparison Mode -->
                    <div id="exportControlsComparison" class="export-controls" style="display: none;">
                        <h4>Export Options</h4>
                        <div class="export-buttons">
                            <button id="exportComparisonChartsBtn" onclick="exportComparisonCharts()">
                                <span>ðŸ“Š</span> Export Charts as PNG
                            </button>
                            <button id="exportComparisonDataBtn" onclick="exportComparisonDataAsCSV()">
                                <span>ðŸ“„</span> Export Data as CSV
                            </button>
                        </div>
                    </div>

                    <div class="comparison-charts">
                        <div class="chart-side">
                            <div class="chart-container">
                                <canvas id="stockChartA"></canvas>
                            </div>
                        </div>
                        <div class="chart-side">
                            <div class="chart-container">
                                <canvas id="stockChartB"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="utils.js"></script>
        <script src="script.js"></script>
    </body>
</html>